Zone Transition Bugs — Root Cause Investigation (2026-02-02)
=============================================================

OPEN BUGS
==========

Bug 5: Diagonal multi-hop fails for floor clicks (except extreme corner)
------------------------------------------------------------------------
Observed
- Diagonal floor clicks only succeed from the single extreme corner tile,
  and only for the closest diagonal target. Most other positions/clicks fail.

Root cause (most likely)
- The computed zone path uses BFS, but BFS path selection is purely based on
  world-graph exit ordering, not on the player’s actual movement direction.
- The transition system arms/commits the edge with the strongest directional
  alignment to the raw click vector. If that first hop doesn’t match the BFS
  path’s first hop, the player transitions into the “other” adjacent zone and
  the path is cleared as “unexpected zone,” so the diagonal hop never completes.
- This mismatch is why it only works when the player is positioned such that
  the dominant direction happens to match the BFS-chosen first hop (often the
  closest diagonal tile from the extreme corner).

Evidence
- BFS path selection (no direction bias): compute-minimap-click-path uses
  world-graph-find-path. (src/movement-core.lisp:661-699, src/world-graph.lisp:182-207)
- Edge selection uses dominant direction from raw click: update-zone-transition
  picks the edge with strongest dot product; player-intent-direction uses raw
  target if clamped. (src/movement-transition.lisp:204-219, 978-997)
- Path is cleared if the player enters a zone not in the BFS path:
  handle-zone-transition clears on “unexpected zone.” (src/main.lisp:909-913)

Bug 6: Minimap diagonal click never completes the hop
-----------------------------------------------------
Observed
- Minimap diagonal clicks never enter the diagonal zone; player walks along
  the seam of the sideways zone and never completes the second hop.

Root cause (most likely)
- Same path/edge mismatch as Bug 5, but more consistent: minimap clicks often
  produce a strong dominant axis (raw click vector), while BFS path’s first hop
  is dictated by world-graph exit order. The player crosses the “wrong” first
  edge, which causes the stored path to be cleared and the diagonal hop to stop.
- The minimap world conversion only extends the view by one tile, so diagonal
  targets tend to produce raw vectors that are strongly biased toward a single
  axis, making the mismatch deterministic.

Evidence
- Minimap click pathing uses BFS: compute-minimap-click-path. (src/movement-core.lisp:661-699)
- Directional gating uses raw click vector: player-intent-direction and
  update-zone-transition. (src/movement-transition.lisp:204-219, 978-997)
- Path clears on unexpected zone: handle-zone-transition. (src/main.lisp:909-913)
- Minimap click world mapping has only 1-tile margin: minimap-screen-to-world.
  (src/input.lisp:348-387)
