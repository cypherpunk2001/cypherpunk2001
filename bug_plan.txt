Zone Transition Bugs — Remediation Plan (2026-02-02)
====================================================

Scope
-----
Fix Bug 5 (floor diagonal hop fails except at extreme corner) and Bug 6
(minimap diagonal hop never completes). Root cause is that continuation hop
targets are clamped (preventing commits), and edge selection is ambiguous
when the hop target overshoots both axes, causing the path to clear.

Issues (Priority)
-----------------
High
- Hop targets are clamped by set-player-walk-target during continuation, which
  pulls the intended out-of-bounds hop back inside the zone and prevents the
  crossing commit from firing reliably.
- Directional gating/world-crossing-edge can select a different edge than the
  stored path (especially when hop targets overshoot both axes), causing the
  continuation to clear the path as “unexpected zone.”

Medium
- Rebase block in handle-zone-transition can overwrite/clear intent before the
  continuation applies the next hop target.

Low
- Minimap margin is only 1 tile; large diagonal minimap clicks can bias the
  raw vector and amplify directional-gating mismatch (symptomatic, not root).

Plan
----

Phase 1 — Primary Fixes (Must)
------------------------------
1) Stop clamping hop targets during continuation:
   - In handle-zone-transition, when applying hop targets, call a helper
     (or pass nil for world) so hop targets remain out-of-bounds and can drive
     crossing commits naturally.
2) Force transitions to follow stored edges:
   - While zone-click-path is active, override directional gating and use the
     stored edge list as authoritative for commit.
3) Unexpected-zone fallback (single retry):
   - If the player lands in an unexpected zone, recompute a new path from the
     current zone to the final destination once. If it fails again, clear path.

Phase 2 — Intent/Rebase Safety (Medium)
--------------------------------------
1) Guard the target-rebase block during multi-hop:
   - If game-zone-click-path is active, skip or defer the one-shot target
     rebase so continuation remains the source of truth.

Phase 3 — Optional (Low / Defer)
-------------------------------
1) Minimap margin tweaks:
   - Only consider if Phase 1 doesn’t fully resolve diagonal minimap hops.

Testing
-------
1) Floor clicks:
   - From multiple positions in zone 3, click various tiles in zone 1 and zone 2.
   - Verify both hops complete and player stops at destination.
2) Minimap clicks:
   - Diagonal minimap targets always complete two hops.
   - Far minimap targets complete multi-hop routes.
3) Regression:
   - Orthogonal clicks still behave exactly as before.
   - No unexpected “path cleared” logs for valid diagonal routes.

Done Criteria
-------------
- Bug 5: diagonal floor clicks succeed from non-corner positions.
- Bug 6: minimap diagonal clicks reliably enter the diagonal zone.
- No new regressions in orthogonal movement or zone transitions.
